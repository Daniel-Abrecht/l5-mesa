From: Timo Aaltonen <tjaalton@debian.org>
Date: Wed, 21 Aug 2019 07:20:18 +0300
Subject: [PATCH] Revert "egl: drop incorrect pkg-config file for glvnd"

This reverts commit 1a25980c469b38d2c6456344fe538ad1bcb47f63.
---
 src/egl/meson.build | 28 ++++++++++++++++++----------
 1 file changed, 18 insertions(+), 10 deletions(-)

diff --git a/src/egl/meson.build b/src/egl/meson.build
index 14aca2a..2b90c63 100644
--- a/src/egl/meson.build
+++ b/src/egl/meson.build
@@ -173,18 +173,26 @@ libegl = shared_library(
   version : egl_lib_version,
 )
 
-if not with_glvnd
-  pkg.generate(
-    name : 'egl',
-    description : 'Mesa EGL Library',
-    version : meson.project_version(),
-    libraries : libegl,
-    libraries_private: gl_priv_libs,
-    requires_private : gl_priv_reqs,
-    extra_cflags : gl_pkgconfig_c_flags,
-  )
+# If using glvnd the pkg-config header should not point to EGL_mesa, it should
+# point to EGL. glvnd is only available on unix like platforms so adding -l
+# should be safe here
+# TODO: in the glvnd case glvnd itself should really be providing this.
+if with_glvnd
+  _egl = '-L${libdir} -lEGL'
+else
+  _egl = libegl
 endif
 
+pkg.generate(
+  name : 'egl',
+  description : 'Mesa EGL Library',
+  version : meson.project_version(),
+  libraries : _egl,
+  libraries_private: gl_priv_libs,
+  requires_private : gl_priv_reqs,
+  extra_cflags : gl_pkgconfig_c_flags,
+)
+
 if with_tests and prog_nm.found()
   if with_glvnd
     egl_symbols = files('egl-glvnd-symbols.txt')
